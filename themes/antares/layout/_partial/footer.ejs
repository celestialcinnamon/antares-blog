<footer class="footer">
  <div class="search-wrapper" id="search">
    <%- partial('_partial/search-view') %>
  </div>

  <section>
    <h4 class="sidebar__title">See me outside</h4>
    <ul>
      <li>
        <a href="https://facebook.com/antaresprogramming" target="_blank"
          >Antares on Facebook</a
        >
      </li>
      <li>
        <a
          href="https://github.com/celestialcinnamon/antares-blog"
          target="_blank"
          >Antares on Github</a
        >
      </li>
    </ul>

    <ul>
      <li>
        <a href="https://facebook.com/dorkas.rubio" target="_blank"
          >See me on Facebook</a
        >
      </li>
      <li>
        <a href="#!" onclick="alert('I told you to not do that')"
          >See me on Twitter</a
        >
        (please don't)
      </li>
      <li>
        <a href="https://instagram.com/melancholicapoptosis" target="_blank"
          >See me on Instagram</a
        >
      </li>
      <li>
        <a href="https://celestialcinnamon.github.io" target="_blank"
          >See my portfolio</a
        >
      </li>
      <li>
        <a href="mailto:https:francoisoibur21@gmail.com" target="_blank"
          >Send me an email:</a
        >
        francoisoibur21@gmail.com
      </li>
    </ul>
  </section>

  <p>&copy; 2018 Francis Rubio</p>
  <p><a href="#">Back to top</a></p>
</footer>
<script>
  const searchDataEndpoint = '<%- config.root %>search.json';
  const searchData = [];

  fetch(searchDataEndpoint)
    .then(raw => raw.json())
    .then(data => searchData.push(...data));

  function searchForContent(wordToMatch, data) {
    const regex = new RegExp(wordToMatch, 'gi');
    
    return data.filter(post => {
      const titleMatched = post.title.match(regex);
      const contentMatched = post.content.match(regex);
      const urlMatched = post.url.match(regex);

      return titleMatched || contentMatched || urlMatched;
    })
  }

  function displayResults() {
    if(this.value === '') {
      searchResults.innerHTML = '';
      return;  
    }

    const matches = searchForContent(this.value, searchData);
    const html = matches.map(item => {
      const regex = new RegExp(this.value, 'gi');
      const title = item.title.replace(regex, `<mark>${this.value}</mark>`);
      const url = '/' + item.url.replace('<%- config.root %>', '');
      const content = item.content
        .replace(regex, `<mark>${this.value}</mark>`)
        .substring(0, 120) + "&hellip;";

      return `
      <li>
        <h3 class="result__header"><a href="${item.url}">${title}</a></h3>
        <span class="result-link"><%- config.url %>${url}</span>
        <p class="content-snippet">${content}</p>
      </li>`;
    })

    searchResults.innerHTML = html.join('');
  }

  const searchInput = document.getElementById('search-input');
  const searchResults = document.querySelector('.search-results');

  searchInput.addEventListener('input', displayResults)
  searchInput.addEventListener('change', displayResults)

</script>
